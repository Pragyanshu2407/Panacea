{% extends "main_app/base.html" %}
{% block content %}
<h4>{{ page_title }}</h4>
<form method="post" class="mb-3">
  {% csrf_token %}
  {{ form.non_field_errors }}
  {{ form.as_p }}
  <button type="submit" class="btn btn-primary">Save</button>
  <a class="btn btn-secondary" href="{% url 'staff_timetable' %}">Back to Timetable</a>
  {% if messages %}
    <div class="mt-2">{% for m in messages %}<div class="alert alert-{{ m.tags }}">{{ m }}</div>{% endfor %}</div>
  {% endif %}
  <p class="text-muted">Publishing extra slots for overlapping scheduled classes.</p>
  <hr/>
  <h5>My Unavailability</h5>
  <table class="table table-sm">
    <thead><tr><th>Session</th><th>Day</th><th>Period</th><th>Duration</th><th>Reason Code</th><th>Reason</th><th>Recurring</th><th>Until</th><th>Exception Date</th><th>Created</th></tr></thead>
    <tbody>
      {% for u in history %}
      <tr>
        <td>{{ u.session }}</td>
        <td>{{ u.day }}</td>
        <td>{{ u.period_number }}</td>
        <td>{{ u.duration_periods }}</td>
        <td>{{ u.get_reason_code_display }}</td>
        <td>{{ u.reason }}</td>
        <td>{% if u.recurring_weekly %}Yes{% else %}No{% endif %}</td>
        <td>{% if u.repeat_until %}{{ u.repeat_until }}{% else %}-{% endif %}</td>
        <td>{% if u.exception_date %}{{ u.exception_date }}{% else %}-{% endif %}</td>
        <td>{{ u.created_at }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="10" class="text-muted">No entries yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</form>
{% endblock %}