{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}{{page_title}}{% endblock page_title %}
{% block content %}
<section class="content">
    <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3>{{total_students}}</h3>

                        <p>Total Students</p>
                    </div>
                    <div class="icon">
                      <i class="nav-icon fas fa-user-graduate"></i>
                    </div>
                    <a href="{% url 'manage_student' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>

                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3>{{total_staff}}</h3>

                        <p>Total Staff</p>
                    </div>
                    <div class="icon">
                      <i class="nav-icon fas fa-users"></i>
                    </div>
                    <a href="{% url 'manage_staff' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-purple">
                    <div class="inner">
                        <h3>{{total_course}}</h3>

                        <p>Total Course</p>
                    </div>
                    <div class="icon">
                      <i class="nav-icon fas fa-th-list"></i>
                    </div>
                    <a href="{% url 'manage_course' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-danger">
                    <div class="inner">
                        <h3>{{total_subject}}</h3>

                        <p>Total Subjects</p>
                    </div>
                    <div class="icon">
                      <i class="nav-icon fas fa-book"></i>
                    </div>
                    <a href="{% url 'manage_subject' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            
            <!-- ./col -->
        </div>
        <!-- /.row -->
        <!-- Keep only three graphs below -->
        <div class="row mt-3">
          <div class="col-lg-6">
            <div class="card card-secondary">
              <div class="card-header">
                <h3 class="card-title">Attendance Trend (14 days)</h3>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                </div>
              </div>
              <div class="card-body">
                <canvas id="attendanceTrendChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card card-secondary">
              <div class="card-header">
                <h3 class="card-title">Feedback Volume (14 days)</h3>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                </div>
              </div>
              <div class="card-body">
                <canvas id="feedbackTrendChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-lg-6">
            <div class="card card-secondary">
              <div class="card-header">
                <h3 class="card-title">Leave Composition (30 days)</h3>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                </div>
              </div>
              <div class="card-body">
                <canvas id="leaveCompositionChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
              </div>
            </div>
          </div>
        </div>
    </div><!-- /.container-fluid -->
</section>
{% endblock content %}

{% block custom_js %}
  <script>
      $(document).ready(function(){
       

      // Removed legacy chart initializations and notifications to keep only 3 graphs

      var attLabels = {{ att_labels|safe }};
      var attCounts = {{ att_counts|safe }};
      var attCtx = $('#attendanceTrendChart').get(0).getContext('2d');
      new Chart(attCtx, {
        type: 'line',
        data: { labels: attLabels, datasets: [{ label: 'Attendance Records', data: attCounts, borderColor: '#28a745', backgroundColor: 'rgba(40,167,69,0.2)', fill: true, tension: 0.25 }] },
        options: { responsive: true, maintainAspectRatio: false }
      });

      var fbLabels = {{ fb_labels|safe }};
      var fbStudent = {{ fb_student|safe }};
      var fbStaff = {{ fb_staff|safe }};
      var fbCtx = $('#feedbackTrendChart').get(0).getContext('2d');
      new Chart(fbCtx, {
        type: 'bar',
        data: {
          labels: fbLabels,
          datasets: [
            { label: 'Student Feedback', data: fbStudent, backgroundColor: '#007bff' },
            { label: 'Staff Feedback', data: fbStaff, backgroundColor: '#ffc107' }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { xAxes: [{ stacked: true }], yAxes: [{ stacked: true }] } }
      });

      var leaveComp = {{ leave_comp_json|safe }};
      var leaveCtx = $('#leaveCompositionChart').get(0).getContext('2d');
      new Chart(leaveCtx, {
        type: 'doughnut',
        data: {
          labels: ['Student Leave', 'Staff Leave'],
          datasets: [{ data: [leaveComp.student || 0, leaveComp.staff || 0], backgroundColor: ['#dc3545', '#17a2b8'] }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });
      
      
      })
  </script>
{% endblock custom_js %}